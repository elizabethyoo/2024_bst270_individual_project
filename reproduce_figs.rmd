---
title: "BST270: Individual Project"
author: "Liz Graff"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Introduction

In this Rmarkdown file I attempt to reproduce the figures that appear in the article
["How Americans Like Their Steak"](https://fivethirtyeight.com/features/how-americans-like-their-steak/) written by Walt Hickey published on May 16, 2014. 

TODO: short summary of article. 



## Package and Data loading 

Load the necessary packages and set the working directory, i.e. , the location
where the repository is housed. Be sure to change the path of the working directory
to your own local directory i.e., `setwd('/path/to/your/local/directory/here')`

```{r, message=FALSE, warning=FALSE}
# load all packages used to wrangle data and generate plots 
library(dplyr)
library(tidyverse)
library(ggplot2)
library(data.table)

# set working directory -- 
setwd('/Users/ecyoo/Desktop/BST270_ReprodDS/2024_bst270_individual_project')
```


## Read data
Next, we load the steak risk survey dataset. It is a single .csv file. If it does
not exist locally, We will download it from FiveThirtyEight's URL. 

```{r}
if (file.exists('./data/steak-survey/steak-risk-survey.csv')) {
  survey_data <- fread('./data/steak-survey/steak-risk-survey.csv')
} else {
  fwrite(survey_data, './data/steak-survey/steak-risk-survey.csv')
}
```

The survey data has 551 rows and 15 columns. The article states 


## Data preprocessing 

```{r}
# get the number of rows and columns in the survey dataset
dim(survey_data)
# check for the number of rows that contain empty values
sum(is.na(survey_data))

# get column names of the data -- they were not included in the dataset README
colnames(survey_data)
rows_with_nas <- survey_data[apply(survey_data, 1, function(x) any(is.na(x))),]
unique(survey_data[,9])

```
We see that the survey data is 551 rows by 15 columns, and the 'Response' entry
takes up a row. The article states that there were 550 respondents, so we will
delete that dummy row. 

We are interested in the following columns:
(1) column 2, the respondent's preference for lottery A (the riskier lottery) vs. lottery B (the safer lottery)
(2) column 9, whether or not they eat steak
(3) column 10, how they like their steak prepared

We'll subset the data to contain these three columns (in addition to respondent IDs) and for brevity and machine-readability, we will rename the columns of interest to: (1) 'lottery' (2) 'eats_steak' (3) 'steak_doneness'.

We are only interested in those that eat steak, so we will filter accordingly. 

```{r}
# subset data
survey_data_sub <- survey_data[,c(1,2,9,10)]
  
# rename columns 2, 9, 10
colnames(survey_data_sub)[2] <- 'lottery'
colnames(survey_data_sub)[3] <- 'eats_steak'
colnames(survey_data_sub)[4] <- 'steak_doneness'

# subset only respondents that eat steak
steak_data <- survey_data_sub[eats_steak=='Yes', ]
```

Since the table and the bar chart are in terms of percentages and not raw values, we calculate the percentages of each steak doneness category, overall and stratified by
lottery type.

```{r}
# calculate population-wide percentages 
steak_data <- steak_data %>%
  count(steak_doneness) %>%
  mutate(percentage = n / sum(n) * 100)

# generate bar plot 
ggplot(steak_data, aes(x = steak_doneness, y = percentage)) +
    geom_col(fill = "blue") +
    geom_text(aes(label = sprintf("%.2f%%", percentage)), vjust = -0.5) +
    ggtitle("Percentage of Each Category") +
    xlab("Category") +
    ylab("Percentage (%)") +
    theme_minimal() + 
    coord_flip() # the bar chart in the article is horizontal

# calculate percentages, stratified by lottery type 
df <- df %>%
    group_by(group_column, category) %>%  # Group by both columns
    summarise(count = n()) %>%  # Count occurrences
    mutate(percentage = count / sum(count) * 100)  # Calculate percentage within each group
```

TODO for overall and stratified percentages

```{r}

df_combined <- df %>%
    # Calculate stratified count
    count(category, strata) %>%
    
    # Calculate total count per category for stratified percentage
    group_by(category) %>%
    mutate(total_strata = sum(n),
           percentage_strata = n / total_strata * 100) %>%
    
    # Calculate overall total for overall percentage
    ungroup() %>%
    mutate(total_overall = sum(n),
           percentage_overall = n / total_overall * 100) %>%
    
    # Select and rename as necessary
    select(category, strata, percentage_overall, percentage_strata)

```
